<div class="space-y-4" *ngIf="reservation; else loadingTpl">
  <div class="flex items-center justify-between">
    <div>
      <a routerLink="/reservations" class="text-xs font-semibold uppercase text-accent">Back</a>
      <h2 class="mt-1 text-2xl font-bold">Reservation {{ reservation.code }}</h2>
    </div>
    <button
      *ngIf="reservation.status === 2"
      class="rounded-lg bg-accent px-4 py-2 text-sm font-semibold text-white"
      (click)="openCheckInModal()"
    >
      Check-in
    </button>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div class="rounded-xl bg-panel p-4 shadow-card">
      <p class="text-xs uppercase tracking-wide text-muted">Guest ID</p>
      <p class="mt-1 text-sm font-semibold">{{ reservation.guestId }}</p>
      <p class="mt-3 text-xs uppercase tracking-wide text-muted">Unit ID</p>
      <p class="mt-1 text-sm font-semibold">{{ reservation.unitId || '-' }}</p>
    </div>

    <div class="rounded-xl bg-panel p-4 shadow-card">
      <p class="text-xs uppercase tracking-wide text-muted">Dates</p>
      <p class="mt-1 text-sm font-semibold">{{ reservation.checkInDate }} -> {{ reservation.checkOutDate }}</p>
      <p class="mt-3 text-xs uppercase tracking-wide text-muted">Status</p>
      <p class="mt-1 text-sm font-semibold">{{ statusLabel(reservation.status) }}</p>
      <p class="mt-3 text-xs uppercase tracking-wide text-muted">Estimated total</p>
      <p class="mt-1 text-sm font-semibold">{{ reservation.totalEstimated | number : '1.2-2' }}</p>
    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="rounded-xl bg-panel p-4 shadow-card">Loading reservation...</div>
</ng-template>

<app-modal [open]="checkInModalOpen" title="Check-in reservation" (close)="checkInModalOpen = false">
  <form class="grid gap-3 md:grid-cols-2" [formGroup]="checkInForm" (ngSubmit)="executeCheckIn()">
    <app-form-field label="Check-in at (optional)">
      <input type="datetime-local" class="w-full rounded-lg border border-slate-300 px-3 py-2" formControlName="checkInAt" />
    </app-form-field>

    <app-form-field label="Room unit price (optional)">
      <input type="number" step="0.01" class="w-full rounded-lg border border-slate-300 px-3 py-2" formControlName="roomUnitPrice" />
    </app-form-field>

    <app-form-field label="Nights (optional)">
      <input type="number" class="w-full rounded-lg border border-slate-300 px-3 py-2" formControlName="roomNights" />
    </app-form-field>

    <div class="md:col-span-2">
      <app-form-field label="Description">
        <input type="text" class="w-full rounded-lg border border-slate-300 px-3 py-2" formControlName="roomDescription" />
      </app-form-field>
    </div>

    <div class="md:col-span-2 flex justify-end gap-2 pt-2">
      <button type="button" class="rounded-md border border-slate-300 px-4 py-2 text-sm" (click)="checkInModalOpen = false">Cancel</button>
      <button type="submit" class="rounded-md bg-accent px-4 py-2 text-sm font-semibold text-white" [disabled]="saving">
        {{ saving ? 'Processing...' : 'Confirm check-in' }}
      </button>
    </div>
  </form>
</app-modal>
